<?php

class LogisticsController extends AppController {

/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*----------------------------------------------------------- Index Function -------------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
    public function index() {																																//
        $this->layout = 'logistics';																														//
    }																																						//
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/

    
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*--------------------------------------- Everything under this bar relates to the angular side only -------------------------------------------------------*/
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
    
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*--------------------------------------------------------- Get Initial Data -------------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*  This is the function called upon page load that grabs all the data via an ajax call. We return the information for the file from the workspace entry    |
    as well as all of the items within the document, the unit data, the constant data, and the permissions.                                                 |
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
    public function getInitialData() 																														//
    {   $this->autorender = false;																															//
 		$this->layout = null;																																//
  	    $this->render('ajax');																																//
        $params = json_decode(file_get_contents('php://input'),true);                                                                                       //
//        $fileURL=$params['fileURL'];			                   																			     			//
        Controller::loadModel('Bugs');	             																										//
        $bugData=$this->Bugs->find('all', array('conditions' => array('status' => '0', 'parentid' => '0')));                                                //
        echo(json_encode($bugData));                                                                                                                        //
    }																																						//
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*--------------------------------------------------------- ADD A NEW ITEM ---------------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*  This is the function that adds a new item. The item can be a new bug, a new feature request, or a new to do list item.                                   |
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
    public function newItem() 		        																												//
    {   $this->autorender = false;																															//
 		$this->layout = null;																																//
  	    $this->render('ajax');																																//
        $params = json_decode(file_get_contents('php://input'),true);                                                                                       //
        $thisItem=$params['fullData'];			                   																			     			//
        Controller::loadModel('Bugs');	             																										//
	    $data = array();																																	//
        $data['Bugs']['parentid'] = 0;          																											//
        $data['Bugs']['bugorfeature'] = $thisItem['type'];          																						//
        $data['Bugs']['fileid'] = 0;                                 																						//
        $data['Bugs']['dataObject'] = json_encode($thisItem['dataObject']);     																			//
        $data['Bugs']['userid']=$this->Auth->user('id');		      																						//
        $data['Bugs']['user']=$this->Auth->user('username');																								//
        $data['Bugs']['status'] = 0;          						    																					//
        $this->Bugs->create();																																//
        $this->Bugs->save($data);												       																		//
																																							//				
        $lastid=$this->Bugs->getLastInsertID();																								              	//
        $bugData=$this->Bugs->find('first', array('conditions' => array('id' => $lastid)));                                                                  //
        echo(json_encode($bugData));                                                                                                                        //
    }																																						//
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*----------------------------------------------------------- SAVE AN ITEM ---------------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*  This is the function that saves a bug after it has been edited.                                   |
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/
    public function saveItem() 		        																												//
    {   $this->autorender = false;																															//
 		$this->layout = null;																																//
  	    $this->render('ajax');																																//
        $params = json_decode(file_get_contents('php://input'),true);                                                                                       //
        $thisItem=$params['fullData'];			                   																			     			//
        Controller::loadModel('Bugs');	             																										//
	    $data = array();																																	//
        $data['Bugs']['parentid'] = 0;          																											//
        $data['Bugs']['bugorfeature'] = $thisItem['bugorfeature'];     																						//
        $data['Bugs']['fileid'] = 0;                                 																						//
        $data['Bugs']['dataObject'] = json_encode($thisItem['dataObject']);     																			//
        $data['Bugs']['userid']=$this->Auth->user('id');		      																						//
        $data['Bugs']['user']=$this->Auth->user('username');																								//
        $data['Bugs']['status'] = 0;          						    																					//
        $this->Bugs->id=$thisItem['id'];																													//
        $this->Bugs->save($data);												       																		//
																																							//	
    }																																						//
/*----------------------------------------------------------------------------------------------------------------------------------------------------------*/

      
}



?>