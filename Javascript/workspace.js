$(function(){

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------------------- ON DOCUMENT READY ------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).ready(function() 																													  //	|
{	var config =																																	//	\
    {   skin: 'kama',	uiColor:'#ECECEC',	extraPlugins : 'autogrow', extraPlugins : 'sharedspace', removePlugins : 'elementspath',				//	\
	    toolbarCanCollapse : false, width:'750', resize_enabled: false, sharedSpaces :  {  top : 'cktoolbar' },										//	\
		toolbar :  [ [ 'Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Bold', 'Italic', 'Underline', 'Strike', 							//	\
		'-', 'RemoveFormat', 'NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'Blockquote', 'Link', 'Unlink', 						//	\
		'Image', 'Table', 'HorizontalRule', 'ShowBlocks', 'TextColor', 'BGColor', 'FontSize' ] ] 													//	\
	}; 																																				//	\
	$('#workspace_description_edit').attr('contenteditable','true');																				//	\
   	$('#workspace_description_edit').ckeditor(config);																								//	\
	for (var a=1;a<=$('.workspace_wrapper').length; a++)																							//	\
	{	$('.workspace_rankselect').append($("<option></option>").attr("value",a).text(a)); 		}													//	\
	$('.workspace_wrapper').each(function( index ) { $(this).find('.workspace_rankselect').prepend($("<option></option>").attr("value",index+1).text(index+1));});
	parsePermissionInfo();																															//	\
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-------------------------------------------------------------------------------------------------------------------------------------------------//
//-------------------------------------------------------------------------------------------------------------------------------------------------//
//-------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('mouseover', '#leftColumnIconsWrapper', function(event) 																			//	\
{	$('#leftColumnTextWrapper').fadeIn('500');																									//	\
});																																				//	\
$(document).on('mouseout', '#leftColumnIconsWrapper, #leftColumnTextWrapper, .leftNavText, .leftNav, #saveFile, #saveFileText, #user, #userText, #logo, #logoText', function(event) 				//	\
{	if (event.pageX>200){	$('#leftColumnTextWrapper').fadeOut('500');		}																	//	\
});																																				//	\
//-------------------------------------------------------------------------------------------------------------------------------------------------//
//-------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//--------------------------------------------------------- Navigating to a file or folder ------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '.workspace_file, .workspace_folder, .workspace_parttree', function(event){ 												//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	window.location.href=$(this).attr('address');																									//	\
}); 																																				//	\
$(document).on('click', '.workspace_dataset', function(event){ 																						//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	window.location.href=$(this).attr('address');																									//	\
}); 																																				//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//----------------------------------------------- ITEMS RELATED TO THE LEFT NAVIGATION LIST -----------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//


//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//--------------------------------------------------- Show the permissions and populate the boxes -----------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '#permissions, #permissionsText', function(event)																			//	\
{	$('#workspace_permissions').show();																												//	\
	$('#Format_Wrapper, #workspace_description_save').hide(); 																						//	\
	$('#workspace_bodywide, #workspace_body, #addView').hide();																						//	\
	$('#folders_current').attr('id', 'folders');																									//	\
	$('#permissionsText').addClass('leftNavTextCurrent').removeClass('leftNavText');																//	\
	$('#foldersText').addClass('leftNavText').removeClass('leftNavTextCurrent');																	//	\
	$('#permissions').attr('id', 'permissions_current');																							//	\
	$('#insertOptions').hide();		                                                      															//	\
});																																					//	\
$(document).on('click', '#folders, #foldersText', function(event)																					//	\
{	$('#workspace_permissions').hide();																												//	\
	$('#Format_Wrapper, #workspace_description_save').hide(); 																						//	\
	$('#workspace_bodywide, #workspace_body, #addView').show();																						//	\
	$('#folders').attr('id', 'folders_current');																									//	\
	$('#foldersText').addClass('leftNavTextCurrent').removeClass('leftNavText');																	//	\
	$('#permissionsText').addClass('leftNavText').removeClass('leftNavTextCurrent');																//	\
	$('#permissions_current').attr('id', 'permissions');																							//	\
	$('#insertOptions').show();		                                                      															//	\
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//--------------------------------------------------------- Adding Files and Folders ------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//	These functions are called whenever a user clicks on an icon to add a new file, folder, dataset, or part tree. An ajax call is made to create the	\
//	new item. If that is successful, the data is displayed appropriately. Note that the user must have edit permission on the parent folder to add a	\
//	new item.																																			\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '#addfolder, #addfolderText', function(event){ 																				//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	var parentid=$(this).attr('parentid');																											//	\
	AddFileFolder(1, parentid, $('.workspace_wrapper').length+1);																					//	\
}); 																																				//	\
$(document).on('click', '#addfile, #addfileText', function(event){ 																					//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	var parentid=$(this).attr('parentid');																											//	\
	AddFileFolder(2, parentid, $('.workspace_wrapper').length+1);																					//	\
}); 																																				//	\
$(document).on('click', '#adddataset, #adddatasetText', function(event){ 																			//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	var parentid=$(this).attr('parentid');																											//	\
	AddFileFolder(3, parentid, $('.workspace_wrapper').length+1);																					//	\
}); 																																				//	\
$(document).on('click', '#addparttree, #addparttreeText', function(event){ 																			//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	var parentid=$(this).attr('parentid');																											//	\
	AddFileFolder(4, parentid, $('.workspace_wrapper').length+1);																					//	\
}); 																																				//	\
function AddFileFolder(option, parentid, rank)																										//	\
{																																					//	\
	$.ajax ({type:"POST", url:"/workspaces/AddFileFolder",																							//	\ 
		data: { option:option, page:window.location.pathname, rank:rank	 },																			//	\
        error: function () { alert('There was an error adding that item');},																		//	\
		success: function (data) 																													//	\
		{	var myData=JSON.parse(data);																											//	\
			if (myData.error!==undefined)																											//	\
			{	$('#message_line').html(myData['error']);																							//	\
			}else 																																	//	\
			{	$('#workspace_foldercontents').append(myData.text);																					//	\
				AddPermissionItem(option, myData.thisID, myData.thisName);                                                                          //  |
                if (option==1) { $('#message_line').html('New Folder Added');}																		//	\
				if (option==2) { $('#message_line').html('New File Created');}																		//	\
				if (option==3) { $('#message_line').html('New Dataset Created');}																	//	\
				if (option==4) { $('#message_line').html('New Part Tree Created');}																	//	\
			}																																		//	\
		}																																			//	\
	});																																				//	\
}																																					//	\
$(document).on('click', '#addimage, #addimageText', function(event){ 	$('#image_uploader').toggle();	$('#Format_Wrapper, #workspace_description_save').hide(); });//	\
$(document).on('click', '#imagedisplay_close', function(event)																						//	\
{ $('#imagedisplay_holder').hide(); $('#Format_Wrapper, #workspace_description_save').hide(); });													//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//


/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*----------------------------------------- FUNCTION TO ADD AN ITEM TO THE PERMISSIONS DOM ------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*  This function is called whenever a new item is added to the workspace. It is called upon successful completion of the AJAX function to add the      |
    item. The code simply adds the new item to the DOM.                                                                                                 |
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
function AddPermissionItem(option, thisID, thisName)                                                                                                //  |
{   partTreeObject['0']['subFiles'][Object.keys(partTreeObject['0']['subFiles']).length]={};	                      								//	\
	if (option==1){ var divClass="systemPermLogo"; } 				                                                  								//	\
	if (option==2){ var divClass="partPermLogo"; } 		                                                      										//	\
	if (option==3){ var divClass="datasetPermLogo"; } 	                                                											//	\
	if (option==4){ var divClass="parttreePermLogo"; } 	                                                       										//	\
	if (option==5){ var divClass="imagePermLogo"; } 		                                                 										//	\
	var addText='<ol class="systemBlock isFile" systemID="'+thisID+'">';	            															//	\
		addText=addText+'<li class="systemLine" systemID="'+thisID+'">';				          													//	\
            addText=addText+'<div class="'+divClass+'"></div>';									    												//	\
            addText=addText+'<div class="systemPermName">'+thisName+'</div>';	                                 	    							//	\
            addText=addText+'<div class="permBar">';												    											//	\
                addText=addText+'<div class="permWrapper" permType="admin"><div class="inheritPerm" systemID="'+thisID+'">Admin : Inherited</div></div>';
				addText=addText+'<div class="permWrapper" permType="edit"><div class="inheritPerm" systemID="'+thisID+'">Edit : Inherited</div></div>';	
				addText=addText+'<div class="permWrapper" permType="use"><div class="openPerm" systemID="'+thisID+'">Use : Everyone</div></div>';	//	\
				addText=addText+'<div class="permWrapper" permType="view"><div class="openPerm" systemID="'+thisID+'">View : Everyone</div></div>';	//	\
            addText=addText+'</div>';					                  							    											//	\
        addText=addText+'</li>';				    	                  							    											//	\
    addText=addText+'</ol>';					                         							    											//	\
    $('#partPermissionContent').children('ol').append(addText);                                                                                     //  \
}   																																				//	\
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*----------------------------------------- FUNCTION TO REMOVE AN ITEM FROM THE PERMISSIONS DOM -------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*  This function is called whenever an item is removed from the workspace. It simply removes an item from the permissions tree.                        |
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
function DeletePermissionItem(thisName)                                                                                                             //  |
{   var tempName=thisName.replace(/_/g ,' ');                                                                                                       //  |
    var thisName=thisName.replace(/ /g ,'_');                                                                                                       //  |
    var itemLoc=10000;                                                                                                                              //  |
    var parent=partTreeObject['0']['Workspace']['name'].replace(/ /g,'_');                                                                          //  |
    $('ol [systemid="/'+parent+'/'+thisName+'"]').remove();                                                                                         //  |
    $('ol [systemid="/'+parent+'/'+tempName+'"]').remove();                                                                                         //  |
    for (var itemID in partTreeObject['0']['subFiles'])                                                                                             //  |
    {   if (partTreeObject['0']['subFiles'][itemID]['Workspace']['name']==thisName)                                                                 //  |
        {   delete partTreeObject['0']['subFiles'][itemID];   itemLoc=itemID;   }                                                                   //  |
        if (partTreeObject['0']['subFiles'][itemID]['Workspace']['name']==tempName)                                                                 //  |
        {   delete partTreeObject['0']['subFiles'][itemID];  itemLoc=itemID;   }                                                                    //  |
    }  																						       													//	|
    for (var a=parseInt(parseInt(itemLoc)+1); a<Object.keys(partTreeObject['0']['subFiles']).length; a++)                                           //  |
    {   partTreeObject['0']['subFiles'][a-1]=partTreeObject['0']['subFiles'][a-1]; }                                                                //  |
    delete partTreeObject['0']['subFiles'][a];                                                                                                      //  |
}   																																				//	|
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*------------------------------------------- FUNCTION TO RENAME AN ITEM IN THE PERMISSIONS DOM -------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*  This function is called whenever an item is renamed in some way. The code simply replaces the name in the permissions tree and object               |
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
function RenamePermissionItem(oldName, newName)                                                                                                     //  |
{   newName=newName.replace(/_/g,' ');                                                                                                              //  |
    oldName=oldName.replace(/_/g,' ');                                                                                                              //  |
    var parent=partTreeObject['0']['Workspace']['name'].replace(/ /g,'_');                                                                          //  |
    $('ol [systemid="/'+parent+'/'+oldName+'"]').find('.systemPermName').html(newName);                                                             //  |
    $('ol [systemid="/'+parent+'/'+oldName+'"]').attr("systemID", newName);                                                                         //  |
    for (var itemID in partTreeObject['0']['subFiles'])                                                                                             //  |
    {   if (partTreeObject['0']['subFiles'][itemID]['Workspace']['name']==oldName)                                                                  //  |
        {   partTreeObject['0']['subFiles'][itemID]['Workspace']['name']=newName;   }                                                               //  |
        if (partTreeObject['0']['subFiles'][itemID]['Workspace']['name']==oldName.replace(/ /g,'_'))                                                //  |
        {   partTreeObject['0']['subFiles'][itemID]['Workspace']['name']=newName;   }                                                               //  |
    }  																																				//	|
}   																																				//	|
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
    
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//----------------------------------------------- ITEMS RELATED TO THE MAIN WORKSPACE VIEW ------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------- EDITING AND SAVING THE TITLE OF THE WORKSPACE --------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '#workspace_title_edit', function(event) 																					//	\
{   var text=$('#workspace_title_edit').html();																										//	\
	$('#workspace_title_wrapper').html('<input id="workspace_title_input" value="'+text+'"/>');														//	\
});																																					//	\
$(document).on('keyup', '#workspace_title_input', function(e) 																						//	\
{	if (((e.type=="keyup")&&((e.keyCode == 13)||(e.which == 13)))||(e.type=="focusout")) 															//	\
	{	var text=$('#workspace_title_input').val();																									//	\
		$.ajax({ url: "/Workspaces/SaveTitle",	type: "POST", data: { page:window.location.pathname, title:text }	});								//	\
			$('#workspace_title_wrapper').html('<div id="workspace_title_edit">'+text+'</div>');													//	\
    }																																				//	\
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//------------------------------------------ EDITING AND SAVING THE DESCRIPTION OF THE WORKSPACE ------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '#workspace_description_edit', function(event) 																				//	\
{	$('#Format_Wrapper, #workspace_description_save').show();																						//	\
	$('.cke_toolgroup, .cke_combo_button').css('background', '#FFFFFF'); 																			//	\
	$('.cke_inner').css('background','transparent').css('padding','2px');																			//	\
});																																					//	\
$(document).on('click', '#workspace_description_save', function(event) 																				//	\
{   var fileid=$('.workspace_filename').attr('fileid');																								//	\
	var text=$('#workspace_description_edit').html();																								//	\
	$.ajax({url: "/Workspaces/SaveDescription",	  type: "POST",	 data: { page:window.location.pathname, description:text }  });						//	\
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-------------------------------------------- CHANGE THE ORDER OF THE ITEMS LISTED ON THE WORKSPACE --------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('change', '#orderby', function(event)    																							//	\
{	$test=$('#workspace_foldercontents');																											//	\
	if ($('#orderby').val()=="datecreated") {$test.find('.workspace_wrapper').sort(function (a,b) {return +a.dataset.saved-+b.dataset.saved;}).appendTo($test);}	
	if ($('#orderby').val()=="datesaved") {$test.find('.workspace_wrapper').sort(function (a,b) {return +a.dataset.created-+b.dataset.created;}).appendTo($test);}	
	if ($('#orderby').val()=="type") {$test.find('.workspace_wrapper').sort(function (a,b) {return +a.dataset.type-+b.dataset.type;}).appendTo($test);}	
	if ($('#orderby').val()=="rank") {$test.find('.workspace_wrapper').sort(function (a,b) {return +a.dataset.rank-+b.dataset.rank;}).appendTo($test);}	
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//--------------------------------------------------------- Moving Up One Folder ----------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '#uponefolder', function(event){ 																							//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	var current=window.location.pathname.replace(/\/$/,'');																							//	\
	current=current.replace(/^\//,'');																												//	\
	var split=current.split('/');																													//	\
	if (split.length==2) { var address="http://www.cadwolf.com"+window.location.pathname; 															//	\
	}else { 																																		//	\
		var address="http://www.cadwolf.com"; 																										//	\
		for (var a=0; a<split.length-1; a++) { address=address+'/'+split[a]; }																		//	\
	}																																				//	\
	window.location.href=address;																													//	\
}); 																																				//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//----------------------------------------------------------- Changing a file name --------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//	This is the function that is activated when a user edits a file or folder name. It makes an ajax call to the server and sends the current file 		\
//	location and the file or folder to be edited. That code on the server checks the permissions of the file or folder in question and changes the 		\
//	name. If there were no problems the code returns normally to the code here and the name is updated on the DOM. If there is a problem, then it is 	\
//	displayed on the error line.																														\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '.workspace_filenameblock', function(event){ 																				//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	var oldName=$(this).text();																														//	\
	$(this).closest('.workspace_filename').attr('oldName',oldName).html('<input type="text" id="inputtohide" value="'+oldName+'">');				//	\
}); 																																				//	\
$(document).on('focusout keyup', '#inputtohide', function(e){ 																						//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	if (((e.type=="keyup")&&((e.keyCode == 13)||(e.which == 13)))) 																					//	\
	{	myDiv=this;																																	//	\
		var newName=$(this).val();																													//	\
		var oldName=$(this).closest('.workspace_filename').attr('oldname');																			//	\
		var fileURL=window.location.pathname.replace(/\/$/,'');																						//	\
		var re=/[a-zA-Z0-9\s\-]+/;																													//	\
        newName=newName.replace(/.jpg|.png|.tiff|.jpeg|.gif|.bmp$/g,'');	           																//	\
		var test=re.exec(newName);																													//	\
		if (test[0]!=newName)																														//	\
		{	$('#message_line').html('Names of items can only have letters, numbers, spaces, dashes, and commas.');									//	\
		}else if (newName=='') {																													//	\
			$(this).closest('.workspace_filename').html('<div class="workspace_filenameblock">'+oldName+'</div>');									//	\
		}else if (newName==oldName) {																												//	\
			$(this).closest('.workspace_filename').html('<div class="workspace_filenameblock">'+oldName+'</div>');									//	\
		}else 																																		//	\
		{	newName=newName.replace(/ /g,'_');													     												//	\
            oldName=oldName.replace(/ /g,'_');														    											//	\
            $.ajax ({	type:"POST", url:"/Workspaces/UpdateName", data: {  fileURL:fileURL, newName:newName, oldName:oldName, image:0 },	    	//	\
                error: function () { alert('There was an error updating that name');},					 	       									//	\
                success: function (data) 																   			     							//	\
                {	var myData=JSON.parse(data);																		        					//	\
                    if (myData.error!==undefined)																				       				//	\
                    {	$(this).closest('.workspace_filename').html('<div class="workspace_filenameblock">'+oldName+'</div>');		      			//	\
                        $('#message_line').html(myData['error']);																		     		//	\
                    }else 																													     	//	\
                    { 	if ($(myDiv).parent().siblings('.workspace_file, .workspace_folder, .workspace_parttree').hasClass("workspace_folder"))	    //	\
                        { 	var address="http://www.cadwolf.com"+window.location.pathname.replace(/\/$/,'')+'/'+newName.replace(/[ ]/g,'_');	    //	\
                        }else if ($(myDiv).parent().siblings('.workspace_file, .workspace_folder, .workspace_parttree').hasClass("workspace_parttree"))//\
                        {	var address="http://www.cadwolf.com"+window.location.pathname.replace(/\/$/,'')+'/'+newName.replace(/[ ]/g,'_');	    //	\
                            address=address.replace('/Workspaces/','/PartTree/'); 												      				//	\
                        }else {	var address="http://www.cadwolf.com"+window.location.pathname.replace(/\/$/,'')+'/'+newName.replace(/[ ]/g,'_');	//	\
                                    address=address.replace('/Workspaces/','/Documents/'); }								    					//	\
                        if ($(myDiv).parent().siblings('.workspace_file, .workspace_folder, .workspace_dataset, .workspace_parttree').hasClass("workspace_folder"))	
                        {	$(myDiv).parent().siblings('.workspace_folder').attr('address', address);					    						//	\
                            $(myDiv).closest('.workspace_filename').html('<div class="workspace_filenameblock">'+newName.replace(/_/g,' ')+'</div>');//	\
                        }else if ($(myDiv).parent().siblings('.workspace_file, .workspace_folder, .workspace_dataset, .workspace_parttree').hasClass("workspace_file"))	
                        {	$(myDiv).parent().siblings('.workspace_file').attr('address', address);					      							//	\
                            $(myDiv).closest('.workspace_filename').html('<div class="workspace_filenameblock">'+newName.replace(/_/g,' ')+'</div>');//	\
                        }else if ($(myDiv).parent().siblings('.workspace_file, .workspace_folder, .workspace_dataset, .workspace_parttree, .workspace_image').hasClass("workspace_image"))	
                        {	$(myDiv).closest('.workspace_filename').html('<div class="workspace_filenameblock">'+newName.replace(/_/g,' ')+'</div>');//	\
                        }else if ($(myDiv).parent().siblings('.workspace_file, .workspace_folder, .workspace_dataset, .workspace_parttree').hasClass("workspace_dataset"))	
                        {	$(myDiv).parent().siblings('.workspace_dataset').attr('address', address);			     								//	\
                            $(myDiv).closest('.workspace_filename').html('<div class="workspace_filenameblock">'+newName.replace(/_/g,' ')+'</div>');//	\
                        }else if ($(myDiv).parent().siblings('.workspace_file, .workspace_folder, .workspace_dataset, .workspace_parttree').hasClass("workspace_parttree"))	
                        {	$(myDiv).parent().siblings('.workspace_parttree').attr('address', address);		     									//	\
                            $(myDiv).closest('.workspace_filename').html('<div class="workspace_filenameblock">'+newName.replace(/_/g,' ')+'</div>');}//\
                        RenamePermissionItem(oldName, newName);                                                                                     //  |
                    }																       															//	\
                }																			        												//	\
            });																						       											//	\
		}																																			//	\
	}else if (e.type=="focusout")																													//	\
	{																																				//	\
		var oldName=$(this).closest('.workspace_filename').attr('oldName');																			//	\
		$(this).closest('.workspace_filename').html('<div class="workspace_filenameblock">'+oldName+'</div>');										//	\
		$(this).focusout();																															//	\
	}																																				//	\
}); 																																				//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//


//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//--------------------------------------------------------- Copying a file or folder ------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//	Obviously, this is the case where the user hsa clicked the button to copy a file or folder on the workspace. The appropriate information is sent	\
//	to an ajax call and if everything is OK, the page is reloaded to save the trouble of formatting another HTML line to be inserted.					\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '.workspace_copy', function(event){ 																						//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	if ($(this).siblings().hasClass('workspace_file')) { var type="file"; }																			//	\
	if ($(this).siblings().hasClass('workspace_folder')) { var type="folder"; }																		//	\
	var fileid=$(this).attr('fileid');																												//	\
	var fileName=$(this).siblings('.workspace_filename').find('.workspace_filenameblock').html();													//	\
	var fileName=fileName.replace(/ /g,'_');																										//	\
	var rank=$('.workspace_wrapper').length+1;																										//	\
	$.ajax ({																																		//	\ 
		type:"POST",																																//	\ 
		url:"/Workspaces/CopyFileFolder",																											//	\ 
		data: { fileName:fileName,	page:window.location.pathname, rank:rank },																		//	\
        error: function () { alert('There was an error copying that item');},																		//	\
		success: function (data) 																													//	\
		{	if (typeof(data)==Object)																												//	\
			{	var myData=JSON.parse(data);																										//	\
				if (myData.error!==undefined){	$('#message_line').html(myData['error']);															//	\
				}else{	location.reload();	}																										//	\					
			} else{	location.reload(); 	}																											//	\
		} 																																			//	\
	});																																				//	\
}); 																																				//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//----------------------------------------------------------- Moving a file or folder -----------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//	When a user wants to move a folder, they click on the icon to do that. The first binding shows the display of the input. The second	handles when	\
//	the user has entered an address and hits return. That function sends the ID of the file to be moved and the string containing the new address along	\
//	with the current rank of that item to be moved. The parent ID of the item being moved is changed to the ID for the string sent. If the moce is 		\
// 	successful, the message is displayed. If the move fails, the message is displayed.																	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '.workspace_move', function(event){ 																						//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	$('.move_line').remove();																														//	\
	if ($(this).closest('.workspace_line').next().hasClass('move_line')) {	$(this).closest('.workspace_line').next().remove();						//	\
	}else																																			//	\
	{	var temp='<div class="move_line"><input type="text" placeholder="Enter New Address" class="moveaddress"></div>';							//	\
		$(this).closest('.workspace_line').after(temp);																								//	\
	}																																				//	\
});																																					//	\
																																					//	\
$(document).on('keyup', '.moveaddress', function(e){ 																								//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	if (((e.type=="keyup")&&((e.keyCode == 13)||(e.which == 13)))||(e.type=="focusout"))			 												//	\
	{	var fileName=$(this).closest('.move_line').prev().find('.workspace_filename').find('.workspace_filenameblock').html();						//	\
		fileName=fileName.replace(/ /g,'_');																										//	\
		var rank=$('.workspace_wrapper').length+1;																									//	\
		$.ajax ({																																	//	\
			type:"POST",																															//	\
			url:"/workspaces/MoveFileFolder",																										//	\ 
			data: { oldAddress:window.location.pathname, newAddress:$(this).val(), fileName:fileName, rank:rank },									//	\
	        error: function () { alert('There was an error moving the file');},																		//	\
			success: function (data) 																												//	\
			{	var myData=JSON.parse(data);																										//	\
				if (myData.error!==undefined){	$('#message_line').html(myData['error']);															//	\
				}else																																//	\
				{	$('.move_line').closest('.workspace_wrapper').remove();																			//	\
					$('#message_line').text('File moved to new location.');		}																	//	\
                    DeletePermissionItem(fileName);                                                                                                 //  | 
			}																																		//	\
		});																																			//	\
	}																																				//	\
}); 																																				//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//


//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------------- Deleting Files and Folders ---------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//	This is the case where the use wants to delete a file. An ajax call is made and if everything goes as planned the file is deleted and the item is	\
//	removeed from the DOM. If not, the item remains and the error message is displayed.																	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '.workspace_delete', function(event){ 																						//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	var fileName=$(this).siblings('.workspace_filename, .workspace_filename_dummy').find('.workspace_filenameblock').html();						//	\
	fileName=fileName.replace(/ /g,'_');																											//	\
	var rank=$(this).closest('.workspace_wrapper').attr('data-rank');																				//	\
	myDiv=this;																																		//	\
	$( "#deleteItem-confirm" ).dialog({ resizable: false, height:180, width:350, modal: true,														//	\
		buttons: {																																	//	\
			"Delete Item": function() {																												//	\
				$( this ).dialog( "close" );																										//	\
				$.ajax ({																															//	\
					type:"POST",																													//	\
					url:"/workspaces/DeleteFileFolder",																								//	\ 
					data: { fileName:fileName,	page:window.location.pathname,	rank:rank },														//	\
			        error: function () { alert('There was an error deleting that item');},															//	\
					success: function (data)  																										//	\
					{	var myData=JSON.parse(data);																								//	\
						var fileID=$(myDiv).attr('fileid');																							//	\
						if (myData.error!==undefined){	$('#message_line').html(myData['error']);													//	\
						}else {	$('.'+fileID).remove(); $('#message_line').html('File or Folder Deleted'); }										//	\		
                        DeletePermissionItem(fileName);                                                                                             //  |
                    }																																//	\
				});																																	//	\
        	},																																		//	\
	        Cancel: function() { $( this ).dialog( "close" ); }																						//	\
       	},																																			//	\
	});																																				//	\
	$('.ui-dialog :button').blur();																													//	\
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//


//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------- CHECKING OUT A DOCUMENT OR FOLDER --------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '.workspace_checkout', function(event){ 																					//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	var fileName=$(this).siblings('.workspace_filename, .workspace_filename_dummy').find('.workspace_filenameblock').html();						//	\
	fileName=fileName.replace(/ /g,'_');																											//	\
	var fileid=$(this).attr('fileid');																												//	\
	myDiv=this;																																		//	\
	$.ajax ({																																		//	\
		type:"POST",																																//	\
		url:"/workspaces/CheckoutDocument",																											//	\ 
		data: {	fileName:fileName,	page:window.location.pathname },																				//	\
        error: function () { alert('There was an error checking out the file');},																	//	\
		success: function (data)  																													//	\
		{	var myData=JSON.parse(data);																											//	\
			if (myData.error!==undefined){	$('#message_line').html(myData['error']);																//	\
			}else																																	//	\
			{	$('#message_line').html('The file is now checked out by you'); 																		//	\
				$(myDiv).siblings('.workspace_filename_dummy').addClass('workspace_filename').removeClass('workspace_filename_dummy');				//	\
				$(myDiv).addClass('checkin_block').removeClass('workspace_checkout').html('&nbsp');													//	\
				myDiv='';																															//	\
			}																																		//	\
		}																																			//	\
	});																																				//	\
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//


//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------- CHECKING IN A DOCUMENT OR FOLDER ---------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '.checkin_block', function(event){ 																							//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
	var fileName=$(this).siblings('.workspace_filename, .workspace_filename_dummy').find('.workspace_filenameblock').html();						//	\
	fileName=fileName.replace(/ /g,'_');																											//	\
	var fileid=$(this).attr('fileid');																												//	\
	$.ajax ({																																		//	\
		type:"POST",																																//	\
		url:"/workspaces/CheckinDocument",																											//	\ 
		data: {	fileName:fileName,	page:window.location.pathname },																				//	\
        error: function () { alert('There was an error checking in the file');},																	//	\
		success: function (data)  																													//	\
		{	var myData=JSON.parse(data);																											//	\
			if (myData.error!==undefined){	$('#message_line').html(myData['error']);																//	\
			}else																																	//	\
			{	$('#message_line').html('The file is now checked in'); 																				//	\
				$('.'+fileid).find('.workspace_coblock').html("Not Checked Out"); 																	//	\
				$('.'+fileid).find('.checkin_block').addClass('workspace_checkout').removeClass('checkin_block').html('&nbsp');						//	\
				$('.'+fileid).find('.workspace_filename').addClass('workspace_filename_dummy').removeClass('workspace_filename');					//	\
			}																																		//	\
		}																																			//	\
	});																																				//	\
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-------------------------------------- SHOWING THE PROPER MESSAGE ON MOUSEOVER OF CHECKIN AND CHECKOUT ----------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('mouseover', '.workspace_checkout', function(event){ $('#message_line').html('Click this icon to check out the document.');	});		//	\
$(document).on('mouseover', '.checkin_block', function(event){ 		$('#message_line').html('Click this icon to check the document back in.');	});	//	\
$(document).on('mouseover', '.checkedout', function(event){ $('#message_line').html('This document is checked out by '+$(this).attr('user')+'.');});//	\
$(document).on('mouseover', '.workspace_copy', function(event){ $('#message_line').html('Copy this file or folder.');	});							//	\
$(document).on('mouseover', '.workspace_move', function(event){	$('#message_line').html('Move this file or folder.');	});							//	\
$(document).on('mouseover', '.workspace_delete', function(event){ $('#message_line').html('Delete this file or folder.');	});						//	\
$(document).on('mouseover', '.workspace_filename', function(event){ $('#message_line').html('Alter the name of this file or folder.');	});			//	\
$(document).on('mouseover', '#uponefolder', function(event){ 	$('#message_line').html('Move up one folder.');		});								//	\
$(document).on('mouseover', '#uponefolder, .workspace_filename, .workspace_delete, .workspace_move, .workspace_copy, .checkedout, .workspace_checkout, .checkin_block', function(event){		
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
});																																					//	\
$(document).on('mouseout', '#uponefolder, .workspace_filename, .workspace_delete, .workspace_move, .workspace_copy, .checkedout, .workspace_checkout, .checkin_block', function(event){		
	$('#message_line').html('');																													//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//------------------------------------------- SHOW AND HIDE THE INFO FOR A FILE OR WORKSPACE ----------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '.workspace_showinfo', function(event)    																					//	\
{   $(this).closest('.workspace_wrapper').find('.workspace_info, .workspace_imagewrapper').toggle('500');											//	\
	if ($(this).closest('.workspace_wrapper').attr('data-type')=="2")																				//	\
	{	var itype=$(this).closest('.workspace_wrapper').find('.workspace_image').attr('type');														//	\
		var fileid=$(this).closest('.workspace_wrapper').find('.workspace_image').attr('fileid');													//	\
		if ($(this).closest('.workspace_wrapper').find('.workspace_image').attr('type')=="image/jpg") { var type="jpg";								//	\
		}else if ($(this).closest('.workspace_wrapper').find('.workspace_image').attr('type')=="image/jpeg") { var type="jpeg";						//	\
		}else if ($(this).closest('.workspace_wrapper').find('.workspace_image').attr('type')=="image/gif") { var type="gif";						//	\
		}else if ($(this).closest('.workspace_wrapper').find('.workspace_image').attr('type')=="image/png") { var type="png";						//	\
		}else if ($(this).closest('.workspace_wrapper').find('.workspace_image').attr('type')=="image/bmp") { var type="bmp";	}					//	\
		$(this).closest('.workspace_wrapper').find('.workspace_imageview').html('<img src="/UserImages/'+fileid+'.'+type+'" />');					//	\
	}																																				//	\
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------------- SHOWING AN UPLOADED IMAGE ----------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '.imageview', function(event){ 																								//	\
    var fileid=$(this).attr('fileid');																												//	\
	var endtype=$(this).siblings('.workspace_filename').find('.workspace_filenameblock').html().match(/\.[a-z,A-Z]+/);								//	\
	$('#imagedisplay').html('<img id="'+fileid+'_image" src="/UserImages/'+fileid+''+endtype+'">');													//	\
	var image = document.getElementById(fileid+'_image');																							//	\
	image.onerror = function () {	if (endtype==".jpg") { this.src = '/UserImages/'+fileid+'.jpeg';  												//	\
	}else if (endtype==".jpeg") { this.src = '/UserImages/'+fileid+'.jpg';  }	}																	//	\
	$('#imagedisplay_holder').show();																												//	\
	$('#Format_Wrapper, #workspace_description_save').hide();																						//	\
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//---------------------------------------------- CHANGE THE RANKING OF THE WORKSPACE ITEM -------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('change', '.workspace_rankselect', function(event)    																				//	\
{	var newrank=$(this).val();																														//	\
	var fileid=$(this).closest('.workspace_line').find('.workspace_filename, .workspace_filename_dummy').attr('fileid');							//	\
	var thisdiv=$(this).closest('.workspace_wrapper');																								//	\
	var fileName=$(this).closest('.workspace_rank').siblings('.workspace_filename').find('.workspace_filenameblock').html();						//	\
	var thisrank=parseInt($('.workspace_wrapper').index($(this).closest('.workspace_wrapper')))+1;													//	\
	if (newrank!=parseInt(thisrank)+1)  																											//	\
	{	if (newrank==1) {	$('#workspace_foldercontents').find('.workspace_wrapper').eq(parseInt(newrank)-1).before(thisdiv);						//	\
		}else if (newrank>thisrank) {	$('#workspace_foldercontents').find('.workspace_wrapper').eq(parseInt(newrank)-1).after(thisdiv);			//	\
		}else						{ 	$('#workspace_foldercontents').find('.workspace_wrapper').eq(parseInt(newrank)-1).before(thisdiv);		}	//	\
	}																																				//	\
	$('.workspace_wrapper').each(function( index ) 																									//	\
	{	$(this).find(".workspace_rankselect option:first").remove();																				//	\
		$(this).find(".workspace_rankselect").prepend($("<option></option>").attr("value",index+1).text(index+1));});								//	\
	$.ajax ({																																		//	\
		type:"POST",																																//	\
		url:"/Workspaces/ChangeRank",																												//	\ 
		data: { fileName:fileName.replace(/ /g,'_'),	page:window.location.pathname, oldrank:thisrank, rank:newrank								//	\
		},																																			//	\
        error: function () { alert('There was an error updating that rank');},																		//	\
		success: function (data)  																													//	\
		{	var myData=JSON.parse(data);																											//	\
			if (myData.error!==undefined){	$('#message_line').html(myData['error']);	}															//	\
		}																																			//	\
	});																																				//	\
	$(this).closest(".workspace_wrapper").attr("data-rank",newrank);																				//	\
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//------------------------------------------------ DEALING WITH THE FILE UPLOAD ITEMS -----------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$("#image_to_upload").change(function () {																											//	\
    var fileid=$('#fileid').attr('fileid');																											//	\
    var file = this.files[0];																														//	\
		var formdata = new FormData();																												//	\
		formdata.append("image", file);																												//	\
		formdata.append("folder",  window.location.pathname.replace(/ /g,'_'));																		//	\
		formdata.append("rank", $('.workspace_wrapper').length+1);																					//	\
		var newName=$('#image_to_upload').val().replace('C:\\fakepath\\','');																		//	\
		var re=/[.gif,.png,.jpeg,.jpg,.tiff]+$/;																									//	\
		var newerName=newName.replace(re,'');																										//	\
		var re=/[a-z,A-Z,0-9,\s,\-,\,]+/;																											//	\
		var test=re.exec(newerName);																												//	\
		if (test[0]!=newerName)																														//	\
		{	$('#message_line').html('Names of items can only have letters, numbers, spaces, dashes, and commas.');									//	\
		}else																																		//	\
		{	$.ajax({																																//	\
				url: "/Workspaces/UploadImage",																										//	\
		        type: "POST",																														//	\
		        data:  formdata,																													//	\
		        processData: false,																													//	\
		        contentType: false,																													//	\
		        success:function(data){																												//	\
		        	if (data=="0") { $('#message_line').html('The image must be a jpg, bmp, png, or gif.'); 										//	\
		        	}else																															//	\
		        	{	data=JSON.parse(data);																										//	\
						if (data.error!==undefined){	$('#message_line').html(data['error']);														//	\
						}else																														//	\
						{	var temp='<div class="workspace_line '+data['id']+'">';																	//	\
		        			temp=temp+'<div class="workspace_image" fileid="'+data['id']+'"></div>';												//	\
		        			var imageName=data['name'].replace(/.jpg|.png|.tiff|.jpeg|.gif|.bmp$/g,'');	           									//	\
                            temp=temp+'<div class="workspace_filename"><div class="workspace_filenameblock">'+imageName+'</div></div>';		       	//	\
		        			temp=temp+'<div class="workspace_copy" fileid="'+data['id']+'"></div>';													//	\
		        			temp=temp+'<div class="workspace_move" fileid="'+data['id']+'"></div>';													//	\
		        			temp=temp+'<div class="workspace_delete" fileid="'+data['id']+'"></div>';												//	\
		        			temp=temp+'<div class="checkin_space">&nbsp</div>';																		//	\
		        			temp=temp+'<div class="workspace_showinfo">&nbsp</div>';																//	\
		        			temp=temp+'<div class="workspace_time" fileid="'+data['id']+'"></div>';													//	\
		        			temp=temp+'<div class="workspace_time" fileid="'+data['id']+'"></div>';													//	\
		        			temp=temp+'<div class="workspace_rank">';																				//	\
			            		temp=temp+'<select class="workspace_rankselect">';																	//	\
									temp=temp+'<option value="'+$('.workspace_wrapper').length+1+'">'+parseInt($('.workspace_wrapper').length)+1+'</option>';	//	\
			            			for (a=1;a<$('.workspace_wrapper').length+1; a++) 																//	\
			            			{ temp=temp+'<option value="'+a+'"></option>'; }																//	\
			            		temp=temp+'</select>';																								//	\
		            		temp=temp+'</div>';																										//	\
		        		temp=temp+'</div>';																											//	\
						$('#workspace_foldercontents').append(temp);																				//	\
                        AddPermissionItem(5, data['id'], imageName);                                                                                //  | 
			        	}																															//	\
		        	}																																//	\
		        }																																	//	\
		    });																																		//	\
		}																																			//	\
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//--------------------------------------------------- THE BUTTON TO REUPLOAD AN IMAGE -----------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$(document).on('click', '.replaceImage', function(event){    																						//	\
	$("#replaceImageUpload").attr('imageID', $(this).attr('fileid'))																				//	\
	document.getElementById('replaceImageUpload').click();																							//	\
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//

//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//--------------------------------------------------- WHEN AN IMAGE IS BEING REPLACED -----------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
$("#replaceImageUpload").change(function () {																										//	\
    var file = this.files[0];																														//	\
	var formdata = new FormData();																													//	\
	formdata.append("image", file);																													//	\
	formdata.append("folder",  window.location.pathname.replace(/ /g,'_'));																			//	\
	formdata.append("imageID", $("#replaceImageUpload").attr('imageID') );																			//	\
	$.ajax({																																		//	\
		url: "/Workspaces/reUploadImage",																											//	\
        type: "POST",																																//	\
        data:  formdata,																															//	\
        processData: false,																															//	\
        contentType: false,																															//	\
        success:function(data){																														//	\
        	if (data=="0") { $('#message_line').html('The image must be a jpg, bmp, or gif.'); 														//	\
        	}else																																	//	\
        	{	data=JSON.parse(data);																												//	\
				if (data.error!==undefined){	$('#message_line').html(data['error']);																//	\
				}else																																//	\
				{	$('#message_line').html('New Image Uploaded');																					//	\
	        	}																																	//	\
        	}																																		//	\
        }																																			//	\
    });																																				//	\
});																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//


//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-------------------------------------------------- ITEMS RELATED TO THE PERMISSIONS VIEW ------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//



/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*----------------------------------------------------- PARSE THE PERMISSION INFORMATION --------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*  This function is called whenever the page is loaded. It takes the HTML data that is given on the page load and parses it into an object. It also    |
    creates a text item that is added to the DOM. The first loop simply handles the current folder, which is the first list in the permission view.     |
    The second loop handles all of the subitems in the current folder.                                                                                  |
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
function parsePermissionInfo()																														//	\
{	var permission='', systemID='', admin=0, lc='', ic="", oc="";																					//	\
	partTreeObject=JSON.parse($('#workspace_permissionTree').text());																				//	\
	dataObject=JSON.parse($('#workspace_fulldata').text());																							//	\
	addText='';																																		//	\
	for (var Index=0; Index<Object.keys(partTreeObject).length; Index++)																			//	\
	{	systemID='';																																//	\
		for (var subIndex=0; subIndex<=Index; subIndex++){ systemID=systemID+'/'+partTreeObject[subIndex]['Workspace']['name'].replace(/ /g, '_'); }//	\
		var admin=getInheritedPermission("admin", $('#username').html(), systemID, systemID, 0, 0);													//	\
		if (admin=='1'){ 	lc="listPerm"; 		ic="inheritPerm"; 		oc="openPerm"; 		myedit='<div class="editList"></div>';					//	\
		}else{ 				lc="listPermDemo"; 	ic="inheritPermDemo"; 	oc="openPermDemo"; 	myedit="";	}											//	\
		systemID=systemID.replace(/^\-/,'');																										//	\
		addText=addText+'<ol class="systemBlock isFolder" systemID="'+partTreeObject[Index]['Workspace']['name']+'">';								//	\
			addText=addText+'<li class="systemLine" systemID="'+systemID+'">';																		//	\
				addText=addText+'<div class="systemPermLogo"></div>';																				//	\
				addText=addText+'<div class="systemPermName">'+partTreeObject[Index]['Workspace']['name']+'</div>';									//	\
				addText=addText+'<div class="permBar">';																							//	\
					if (partTreeObject[Index]['Workspace']['admin_status']=='0') 																	//	\
					{	addText=addText+'<div class="permWrapper" permType="admin">';																//	\
						addText=addText+'<div class="'+lc+'" systemID="'+systemID+'">Admin : As Listed</div>'+myedit+'</div>';}						//	\
					if (partTreeObject[Index]['Workspace']['admin_status']=='2') 																	//	\
					{	addText=addText+'<div class="permWrapper" permType="admin">';																//	\
						addText=addText+'<div class="'+ic+'" systemID="'+systemID+'">Admin : Inherited</div></div>';}								//	\
					if (partTreeObject[Index]['Workspace']['edit_status']=='0') 																	//	\
					{	addText=addText+'<div class="permWrapper" permType="edit">';																//	\
						addText=addText+'<div class="'+lc+'" systemID="'+systemID+'">Edit : As Listed</div>'+myedit+'</div>'; }						//	\
					if (partTreeObject[Index]['Workspace']['edit_status']=='2') 																	//	\
					{	addText=addText+'<div class="permWrapper" permType="edit">';																//	\
						addText=addText+'<div class="'+ic+'" systemID="'+systemID+'">Edit : Inherited</div></div>';}								//	\
					if (partTreeObject[Index]['Workspace']['use_status']=='0') 																		//	\
					{	addText=addText+'<div class="permWrapper" permType="use">';																	//	\
						addText=addText+'<div class="'+lc+'" systemID="'+systemID+'">Use : As Listed</div>'+myedit+'</div>'; }						//	\
					if (partTreeObject[Index]['Workspace']['use_status']=='1') 																		//	\
					{	addText=addText+'<div class="permWrapper" permType="use">';																	//	\
						addText=addText+'<div class="'+oc+'" systemID="'+systemID+'">Use : Everyone</div></div>';}									//	\
					if (partTreeObject[Index]['Workspace']['use_status']=='2') 																		//	\
					{	addText=addText+'<div class="permWrapper" permType="use">';																	//	\
						addText=addText+'<div class="'+ic+'" systemID="'+systemID+'">Use : Inherited</div></div>';}									//	\
					if (partTreeObject[Index]['Workspace']['view_status']=='0') 																	//	\
					{	addText=addText+'<div class="permWrapper" permType="view">';																//	\
						addText=addText+'<div class="'+lc+'" systemID="'+systemID+'">View : As Listed</div>'+myedit+'</div>'; }						//	\
					if (partTreeObject[Index]['Workspace']['view_status']=='1') 																	//	\
					{	addText=addText+'<div class="permWrapper" permType="view">';																//	\
						addText=addText+'<div class="'+oc+'" systemID="'+systemID+'">View : Everyone</div></div>';}									//	\
					if (partTreeObject[Index]['Workspace']['view_status']=='2') 																	//	\
					{	addText=addText+'<div class="permWrapper" permType="view">';																//	\
						addText=addText+'<div class="'+ic+'" systemID="'+systemID+'">View : Inherited</div></div>';}								//	\
//					addText=addText+'<div class="editList" systemID="'+systemID+'"></div>';															//	\
				addText=addText+'</div>';																											//	\
			addText=addText+'</li>';																												//	\
	}																																				//	\
	partTreeObject[Index-1]['subFiles']={};																											//	\
	for (var subIndex=0; subIndex<Object.keys(dataObject).length; subIndex++)																		//	\
	{	newsystemID=systemID+'/'+dataObject[subIndex]['Workspace']['name'];																			//	\
		partTreeObject[Index-1]['subFiles'][subIndex]=dataObject[subIndex];																			//	\
		admin=0;																																	//	\
		admin=getInheritedPermission("admin", $('#username').html(), newsystemID, systemID, 1, subIndex);											//	\
//		console.log('The admin stuff is '+admin+' - '+$('#username').html()+' - '+newsystemID+' - '+systemID+' - '+subIndex);
		if ((admin=='1')||(admin=='1a')||(admin=='1b'))																								//	\
		{ 			lc="listPerm"; 		ic="inheritPerm"; 		oc="openPerm"; 		myedit='<div class="editList"></div>';							//	\
		}else{ 		lc="listPermDemo"; 	ic="inheritPermDemo"; 	oc="openPermDemo"; 	myedit="";	}													//	\
		if (dataObject[subIndex]['Workspace']['File_or_Folder']==0){ var divClass="systemPermLogo"; } 												//	\
		if (dataObject[subIndex]['Workspace']['File_or_Folder']==1){ var divClass="partPermLogo"; } 												//	\
		if (dataObject[subIndex]['Workspace']['File_or_Folder']==2){ var divClass="imagePermLogo"; } 												//	\
		if (dataObject[subIndex]['Workspace']['File_or_Folder']==3){ var divClass="datasetPermLogo"; } 												//	\
		if (dataObject[subIndex]['Workspace']['File_or_Folder']==4){ var divClass="parttreePermLogo"; } 											//	\
		addText=addText+'<ol class="systemBlock isFile" systemID="'+newsystemID+'">';																//	\
			addText=addText+'<li class="systemLine" systemID="'+newsystemID+'">';																	//	\
				addText=addText+'<div class="'+divClass+'"></div>';																					//	\
				addText=addText+'<div class="systemPermName">'+dataObject[subIndex]['Workspace']['name']+'</div>';									//	\
				addText=addText+'<div class="permBar">';																							//	\
					if (dataObject[subIndex]['Workspace']['admin_status']=='0') 																	//	\
					{	addText=addText+'<div class="permWrapper" permType="admin">';																//	\
						addText=addText+'<div class="'+lc+'" systemID="'+newsystemID+'">Admin : As Listed</div>'+myedit+'</div>';}					//	\
					if (dataObject[subIndex]['Workspace']['admin_status']=='2') 																	//	\
					{	addText=addText+'<div class="permWrapper" permType="admin">';																//	\
						addText=addText+'<div class="'+ic+'" systemID="'+newsystemID+'">Admin : Inherited</div></div>';}							//	\
					if (dataObject[subIndex]['Workspace']['edit_status']=='0') 																		//	\
					{	addText=addText+'<div class="permWrapper" permType="edit">';																//	\
						addText=addText+'<div class="'+lc+'" systemID="'+newsystemID+'">Edit : As Listed</div>'+myedit+'</div>';}					//	\
					if (dataObject[subIndex]['Workspace']['edit_status']=='2') 																		//	\
					{	addText=addText+'<div class="permWrapper" permType="edit">';																//	\
						addText=addText+'<div class="'+ic+'" systemID="'+newsystemID+'">Edit : Inherited</div></div>';}								//	\
					if (dataObject[subIndex]['Workspace']['use_status']=='0') 																		//	\
					{	addText=addText+'<div class="permWrapper" permType="use">';																	//	\
						addText=addText+'<div class="'+lc+'" systemID="'+newsystemID+'">Use : As Listed</div>'+myedit+'</div>';}					//	\
					if (dataObject[subIndex]['Workspace']['use_status']=='1') 																		//	\
					{	addText=addText+'<div class="permWrapper" permType="use">';																	//	\
						addText=addText+'<div class="'+oc+'" systemID="'+newsystemID+'">Use : Everyone</div></div>';}								//	\
					if (dataObject[subIndex]['Workspace']['use_status']=='2') 																		//	\
					{	addText=addText+'<div class="permWrapper" permType="use">';																	//	\
						addText=addText+'<div class="'+ic+'" systemID="'+newsystemID+'">Use : Inherited</div></div>';}								//	\
					if (dataObject[subIndex]['Workspace']['view_status']=='0') 																		//	\
					{	addText=addText+'<div class="permWrapper" permType="view">';																//	\
						addText=addText+'<div class="'+lc+'" systemID="'+newsystemID+'">View : As Listed</div>'+myedit+'</div>';}					//	\
					if (dataObject[subIndex]['Workspace']['view_status']=='1') 																		//	\
					{	addText=addText+'<div class="permWrapper" permType="view">';																//	\
						addText=addText+'<div class="'+oc+'" systemID="'+newsystemID+'">View : Everyone</div></div>';}								//	\
					if (dataObject[subIndex]['Workspace']['view_status']=='2') 																		//	\
					{	addText=addText+'<div class="permWrapper" permType="view">';																//	\
						addText=addText+'<div class="'+ic+'" systemID="'+newsystemID+'">View : Inherited</div></div>';}								//	\
//					addText=addText+'<div class="editList" systemID="'+newsystemID+'"></div>';														//	\
				addText=addText+'</div>';																											//	\
			addText=addText+'</li>';																												//	\
		addText=addText+'</ol>';																													//	\
	}																																				//	\
	for (var Index=0; Index<Object.keys(partTreeObject).length; Index++){ addText=addText+'</ol>';	}												//	\
	$('#partPermissionContent').html(addText);																										//	\
}																																					//	\
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//
//-----------------------------------------------------------------------------------------------------------------------------------------------------//


/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------ CLICK ON A PERMISSION WITH INTENT TO EDIT IT -----------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*	When a user wants to change a permission between inheriting it, setting a list of users, and everyone, they click on the permission in question and an option box	\
	is shown.																																							\
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).on('click', '.inheritPerm, .openPerm, .listPerm', function(e)																							//	\
{	var htmlText='';										 																										//	\
	var permType=$(this).closest('.permWrapper').attr('permType');																									//	\
	var Index=$('.systemBlock').index($(this).closest('.systemBlock'));																								//	\
	$('.permWrapperActive').find('.permSelectBox, .permSelectBoxSmall').remove(); 																					//	\
	if ($(this).parent().hasClass('permWrapperActive'))																												//	\
	{	$('.permWrapperActive').removeClass('permWrapperActive'); 																									//	\
	}else																																							//	\
	{	$('.permWrapperActive').removeClass('permWrapperActive'); 																									//	\
		$(this).closest('.permWrapper').addClass('permWrapperActive');																								//	\
		if (((permType=="admin")||(permType=="edit"))&&(Index>0))																									//	\
		{	htmlText='<div class="permSelectBoxSmall">';																											//	\
				htmlText=htmlText+'<div class="permSelectLine"><div class="permInherit">Inherited</div></div>';														//	\
				htmlText=htmlText+'<div class="permSelectLine"><div class="permList">As Listed</div></div>';														//	\
			htmlText=htmlText+'</div>';																																//	\
		}else if (Index>0)																																			//	\
		{	htmlText='<div class="permSelectBox">';																													//	\
				htmlText=htmlText+'<div class="permSelectLine"><div class="permInherit">Inherited</div></div>';														//	\
				htmlText=htmlText+'<div class="permSelectLine"><div class="permOpen">Everyone</div></div>';															//	\
				htmlText=htmlText+'<div class="permSelectLine"><div class="permList">As Listed</div></div>';														//	\
			htmlText=htmlText+'</div>';																																//	\
		}else if ((Index==0)&&((permType=="view")||(permType=="use")))																								//	\
		{	htmlText='<div class="permSelectBoxSmall">';																											//	\
				htmlText=htmlText+'<div class="permSelectLine"><div class="permOpenShort">Everyone</div></div>';													//	\
				htmlText=htmlText+'<div class="permSelectLine"><div class="permList">As Listed</div></div>';														//	\
			htmlText=htmlText+'</div>';																																//	\
		}																																							//	\
		$(this).closest('.permWrapper').append(htmlText);																											//	\
	}																																								//	\																																									//	\
});																																									//	\
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------- SELECT A PERMISSION FOR A FILE OR FOLDER -------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*	By selecting one of the options for the permission, the code alters the appearance of the permission and sets the database accordingly.								\
	Rules : Admin and Edit permissions cannot be set to everyone. They can only be set to a list or inherit																\
			When a permission is set to list, all higher permissions are set to list as well. An use permission cannot be for everyone while only some can view. Also,	\
				an edit perm cannot inherit while a view or use has a list.																								\
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).on('click', '.permOpen, .permList, .permInherit', function(e)																							//	\
{	var perm='', systemID='', openHtml='', listHtml='', inheritHtml='', permType='';																				//	\
	myDiv=this.closest('.permBar');							 																										//	\
	permType=$(this).closest('.permWrapperActive').attr('permType').replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase();});//	\
	$(this).closest('.partLine, .systemLine').find('.editUserBlock').remove();																						//	\
	if ($(this).hasClass('permOpen')){ perm="open"; } 																												//	\
	if ($(this).hasClass('permList')){ perm="list"; } 																												//	\
	if ($(this).hasClass('permInherit')){ perm="inherit"; } 																										//	\
	if ($(this).closest('.partLine').length>0){ systemID=$(this).closest('.partLine').attr('partID').replace(/ /g,'_'); } 											//	\
	if ($(this).closest('.systemLine').length>0){ systemID=$(this).closest('.systemLine').attr('systemID').replace(/ /g,'_'); } 									//	\
	if ($(this).closest('.systemBlock').hasClass('isFile'))																											//	\
	{		fileIndex=$('.isFile').index($(this).closest('.systemBlock'));																							//	\
			Index=$('.isFolder').index($(this).closest('.isFolder'));																								//	\
			permObject=partTreeObject[Index]['subFiles'][fileIndex]['Workspace'];																					//	\
	}else 	Index=$('.systemBlock').index($(this).closest('.isFolder'));																							//	\
	{		permObject=partTreeObject[Index]['Workspace'];																											//	\
	}																																								//	\
	$.ajax ({																																						//	\
		type:"POST", url:"/Workspaces/updatePermission", data: { systemID:systemID, permType:permType, permission:perm	},											//	\
		success: function(data) 																																	//	\
	    {	myData=JSON.parse(data); 																																//	\
			if (myData.error!==undefined)																															//	\
			{	$('#errorLine').html(myData.error);																													//	\
			}else																																					//	\
			
			{	if (myData.admin.toString()=="0"){ $(myDiv).find('.permWrapper[permType=admin]').html('<div class="listPerm" systemID="'+systemID+'" permType="admin">Admin - As Listed</div><div class="editList"></div>'); }	
				if (myData.admin.toString()=="2"){ $(myDiv).find('.permWrapper[permType=admin]').html('<div class="inheritPerm" systemID="'+systemID+'" permType="admin">Admin - Inherited</div>'); }	
				if (myData.edit.toString()=="0"){ $(myDiv).find('.permWrapper[permType=edit]').html('<div class="listPerm" systemID="'+systemID+'" permType="edit">Edit - As Listed</div><div class="editList"></div>'); }	
				if (myData.edit.toString()=="2"){ $(myDiv).find('.permWrapper[permType=edit]').html('<div class="inheritPerm" systemID="'+systemID+'" permType="edit">Edit - Inherited</div>'); }	
				if (myData.use.toString()=="0"){ $(myDiv).find('.permWrapper[permType=use]').html('<div class="listPerm" systemID="'+systemID+'" permType="use">Use - As Listed</div><div class="editList"></div>'); }	
				if (myData.use.toString()=="1"){ $(myDiv).find('.permWrapper[permType=use]').html('<div class="openPerm" systemID="'+systemID+'" permType="use">Use - Everyone</div>'); }	
				if (myData.use.toString()=="2"){ $(myDiv).find('.permWrapper[permType=use]').html('<div class="inheritPerm" systemID="'+systemID+'" permType="use">Use - Inherited</div>'); }	
				if (myData.view.toString()=="0"){ $(myDiv).find('.permWrapper[permType=view]').html('<div class="listPerm" systemID="'+systemID+'" permType="view">View - As Listed</div><div class="editList"></div>'); }	
				if (myData.view.toString()=="1"){ $(myDiv).find('.permWrapper[permType=view]').html('<div class="openPerm" systemID="'+systemID+'" permType="view">View - Everyone</div>'); }	
				if (myData.view.toString()=="2"){ $(myDiv).find('.permWrapper[permType=view]').html('<div class="inheritPerm" systemID="'+systemID+'" permType="view">View - Inherited</div>'); }	
				$('.permWrapper').removeClass('permWrapperActive'); 																								//	\
		 		$('.permSelectBox').remove(); 																														//	\
//				var num=systemID.replace(/^\//,'').split('/').length-1;																								//	\
				permObject['admin_status']=myData.admin;																											//	\
				permObject['edit_status']=myData.edit;																												//	\
				permObject['use_status']=myData.use;																												//	\
				permObject['view_status']=myData.view;																												//	\
			}																																						//	\
		},																																							//	\
	    error: function () { alert('There was an error updating that permission.');}																				//	\
	});																																								//	\
});																																									//	\
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------- CLICK ON AN ICON TO ADD OR REMOVE USERS ON THE PERMISSIONS LIST ------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*	An icon is shown next to all items with a permission of 2 meaning that the user must be on the list. By clicking this icon, the user is shown both 					\
	an input box to enter new names of users and groups and a list of current users with permisssion and the option to delete those users individually.					\
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).on('click', '.editList', function(e)																													//	\
{	var htmlText='', permission='', userName='', Index=0, fileIndex=0, permObject={}, flag=0;	 																	//	\
	var systemID=$(this).siblings('.listPerm').attr('systemID');																									//	\
	var permType=$(this).closest('.permWrapper').attr('permType');																									//	\
	var fileIndex=$(this).closest('.systemBlock').index('.systemBlock')-1;																							//	\
	if ($(this).closest('.partLine, .systemLine').children('.editUserBlock').length>0)																				//	\
	{	$(this).closest('.partLine, .systemLine').find('.editUserBlock').remove();																					//	\
	}else																																							//	\
	{	if (fileIndex>=0){ 	permObject=partTreeObject[0]['subFiles'][fileIndex];																					//	\
		}else{ 				permObject=partTreeObject[0];	 }																										//	\
		htmlText=htmlText+'<div class="editUserBlock">';																											//	\
			htmlText=htmlText+'<div id="errorLine">'+permType+' permissions for '+systemID+'</div>';																//	\
			htmlText=htmlText+'<div class="enterUserLine">';																										//	\
				htmlText=htmlText+'<input class="newUser" permType="'+permType+'" systemID="'+systemID+'" placeholder="Enter User Name">';							//	\
			htmlText=htmlText+'</div>';																																//	\
			htmlText=htmlText+'<div class="usersBlock">';																											//	\
				for (var permIndex in permObject['Permissions'])																									//	\
				{	flag=0;																																			//	\
					userName=permObject['Permissions'][permIndex]['Permission']['username'];																		//	\
					if ((permType=="admin")&&(permObject['Permissions'][permIndex]['Permission']['admin']=='1'))													//	\
					{	flag=1;		}																																//	\
					if ((permType=="edit")&&(permObject['Permissions'][permIndex]['Permission']['edit']=='1'))														//	\
					{	flag=1;		}																																//	\
					if ((permType=="use")&&(permObject['Permissions'][permIndex]['Permission']['use']=='1'))														//	\
					{	flag=1;		}																																//	\
					if ((permType=="view")&&(permObject['Permissions'][permIndex]['Permission']['view']=='1'))														//	\
					{	flag=1;		}																																//	\
					if (flag==1)																																	//	\
					{		htmlText=htmlText+'<div class="permUser" permType="'+permType+'" systemID="'+systemID+'">'+userName+''; 								//	\
							htmlText=htmlText+'<div class="permDelete" permType="'+permType+'" userName="'+userName+'" systemID="'+systemID+'"></div></div>';		//	\
					}																																				//	\
				}																																					//	\
			htmlText=htmlText+'</div>';																																//	\
		htmlText=htmlText+'</div>';																																	//	\
		$(this).closest('.partLine, .systemLine').append(htmlText);																									//	\
	}																																								//	\
});																																									//	\
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------- GET THE INHERITED PERMISSION FOR A FOLDER AND USER -----------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*	This function is given a system ID and it then goes up the folder tree and finds the closest folder that isn't inherited. 							\
	1 			- Came to folder where permission is sset to everyone 																					\
	1a 			- this folder has list permission with the user on it with permission 																	\
	0a 			- this folder has list permission without the user on it. 																				\
	1b 			- came to a folder that has list permission with the user on it with permission 														\
	0b 			- came to a folder that has list permission without the user on it. 																	\
	fileFlag 	- 1 if the item is a file in this folder, 0 if one of the parent folders																\
	fileIndex	- if the item is a file, the index within the subfiles folder																			\
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
function getInheritedPermission(permType, userName, systemID, parentSystem, fileFlag, fileIndex)													//	\
{	var permission='0';																																//	\
	var num=systemID.replace(/^\//,'').split('/').length-1;																							//	\
	if ((num==-1)||(num==0)) { num=0; fileFlag=0; } 																								//	\
	var sP=systemID.replace(/^\//,'').split('/');																									//	\
//console.log('The parameters for permissions are '+permType+' - '+userName+' - '+systemID+' - '+parentSystem+' - '+fileFlag+' - '+fileIndex);
	if (systemID==''){ num=0; }																														//	\
	if (fileFlag==1) 																																//	\
	{	num=num-1;																																	//	\
		if (sP.length==2) { num=0; }																												//	\
//console.log('The part tree object permissions type is '+partTreeObject[num]['subFiles'][fileIndex]['Workspace'][permType+'_status']);
		if (partTreeObject[num]['subFiles'][fileIndex]['Workspace'][permType+'_status']=="1"){ return "1"; 											//	\
		}else if (partTreeObject[num]['subFiles'][fileIndex]['Workspace'][permType+'_status']=="0")													//	\
		{	for (pindex in partTreeObject[num]['subFiles'][fileIndex]['Permissions'])																//	\
			{	if (partTreeObject[num]['subFiles'][fileIndex]['Permissions'][pindex]['Permission']['username']==userName)							//	\
				{	if (systemID==parentSystem)																										//	\
					{		if(partTreeObject[num]['subFiles'][fileIndex]['Permissions'][pindex]['Permission'][permType]=='1') { return "1a" }else { return "0a" } 	
					}else{	if(partTreeObject[num]['subFiles'][fileIndex]['Permissions'][pindex]['Permission'][permType]=='1') { return "1b" }else { return "0b" } } } }
			if (systemID==parentSystem){ return "0a" }else{ return "0b" } 																			//	\
		}else if (partTreeObject[num]['subFiles'][fileIndex]['Workspace'][permType+'_status']=="2")													//	\
		{	var newSystemID=systemID.replace(/\-[0-9a-zA-Z]+$/,'');																					//	\
			if (newSystemID==systemID){newSystemID=''; }																							//	\
//			return getInheritedPermission(permType, userName, newSystemID, 0)																		//	\
console.log('The part tree object permissions type is '+partTreeObject[0]['Workspace'][permType+'_status']);
			if (partTreeObject[0]['Workspace'][permType+'_status']=="1"){ return "1"; 																//	\
			}else if (partTreeObject[0]['Workspace'][permType+'_status']=="0")																		//	\
			{	for (pindex in partTreeObject[0]['Permissions'])																						//	\
				{	console.log('For user name '+userName+', the permission is '+partTreeObject[0]['Permissions'][pindex]['Permission'][permType]);
					if (partTreeObject[0]['Permissions'][pindex]['Permission']['username']==userName)													//	\
					{	if (systemID==parentSystem)																										//	\
						{		if(partTreeObject[0]['Permissions'][pindex]['Permission'][permType]=='1') { return "1a" }else { return "0a" } 		//	\
						}else{	if(partTreeObject[0]['Permissions'][pindex]['Permission'][permType]=='1') { return "1b" }else { return "0b" } } } }	//	\
				if (systemID==parentSystem){ return "0a" }else{ return "0b" } 																			//	\
			}else if (partTreeObject[num]['Workspace'][permType+'Status']=="2")																			//	\
			{	var newSystemID=systemID.replace(/\-[0-9a-zA-Z]+$/,'');																					//	\
				if (newSystemID==systemID){newSystemID=''; }																							//	\
				return getInheritedPermission(permType, userName, newSystemID, 0)																		//	\
			}																																			//	\
		}																																			//	\		
		return '0';																																	//	\
	}else																																			//	\
	{	if (partTreeObject[num]['Workspace'][permType+'_status']=="1"){ return "1"; 																//	\
		}else if (partTreeObject[num]['Workspace'][permType+'_status']=="0")																		//	\
		{	for (pindex in partTreeObject[num]['Permissions'])																						//	\
			{	if (partTreeObject[num]['Permissions'][pindex]['Permission']['username']==userName)													//	\
				{	if (systemID==parentSystem)																										//	\
					{		if(partTreeObject[num]['Permissions'][pindex]['Permission'][permType]=='1') { return "1a" }else { return "0a" } 		//	\
					}else{	if(partTreeObject[num]['Permissions'][pindex]['Permission'][permType]=='1') { return "1b" }else { return "0b" } } } }	//	\
			if (systemID==parentSystem){ return "0a" }else{ return "0b" } 																			//	\
		}else if (partTreeObject[num]['Workspace'][permType+'Status']=="2")																			//	\
		{	var newSystemID=systemID.replace(/\-[0-9a-zA-Z]+$/,'');																					//	\
			if (newSystemID==systemID){newSystemID=''; }																							//	\
			return getInheritedPermission(permType, userName, newSystemID, 0)																		//	\
		}																																			//	\
	}																																				//	\
}																																					//	\
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*--------------------------------------------------------- DELETE A USER PERMISSION ------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*	This is the case where the user clicks to delete the permissions of one user. The code removes the HTML element from the DOM and then pings the 	\
	server to remove the permission from there.																											\
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).on('click', '.permDelete', function(e)																									//	\
{	var admin=0, edit=0, use=0, view=0;																												//	\
	var systemID=$(this).attr('systemID').replace(/ /g,'_');																						//	\
	var userName=$(this).attr('userName').replace(/ /g,'_');																						//	\
	var permType=$(this).attr('permType');																											//	\
	var fileIndex=$(this).closest('.systemBlock').index('.systemBlock')-1;																			//	\
	myDiv=this;																																		//	\
	$.ajax ({																																		//	\
		type:"POST", url:"/Workspaces/deleteUserPerm", data: { systemID:systemID.replace(/ /g,'_'), userName:userName.replace(/ /g,'_'), permType:permType },												//	\
		success: function(data) 																													//	\
		{	myData=JSON.parse(data);																												//	\
			if (myData.error!==undefined)																											//	\
			{	$('#errorLine').html(myData.error);																									//	\
			}else																																	//	\
			{	$(myDiv).closest('.permUser').remove();																								//	\
				if (fileIndex>=0){ 	permObject=partTreeObject[0]['subFiles'][fileIndex];															//	\
				}else{ 				permObject=partTreeObject[0];	 }																				//	\
				for (var permIndex in permObject['Permissions'])																					//	\
				{	if (userName==permObject['Permissions'][permIndex]['Permission']['username'])													//	\
					{	if (permType=="view")																										//	\
						{	permObject['Permissions'][permIndex]['Permission']['admin']=0;															//	\
							permObject['Permissions'][permIndex]['Permission']['edit']=0;															//	\
							permObject['Permissions'][permIndex]['Permission']['use']=0;															//	\
							permObject['Permissions'][permIndex]['Permission']['view']=0;															//	\
						} 																															//	\
						if (permType=="use")																										//	\
						{	permObject['Permissions'][permIndex]['Permission']['admin']=0;															//	\
							permObject['Permissions'][permIndex]['Permission']['edit']=0;															//	\
							permObject['Permissions'][permIndex]['Permission']['use']=0;															//	\
						} 																															//	\
						if (permType=="edit")																										//	\
						{	permObject['Permissions'][permIndex]['Permission']['admin']=0;															//	\
							permObject['Permissions'][permIndex]['Permission']['edit']=0;															//	\
						} 																															//	\
						if (permType=="admin")																										//	\
						{	permObject['Permissions'][permIndex]['Permission']['admin']=0;															//	\
						} 																															//	\
					} 																																//	\
				} 																																	//	\
																																					//	\
			}																																		//	\
		},																																			//	\
	    error: function () { alert('There was an error deleting that permission.');}																//	\
	});																																				//	\
});																																					//	\
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-----------------------------------------------------------------------------------------------------------------------------------------------------*/

/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------------------- ADD A USER PERMISSION ---------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*	This is the case where the wants to add a new user to the list. The code sends the name to the database to be added. If that is done right, then the name is 		\
	added. If there is a problem, the error is reported.																												\
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).on('keyup', '.newUser', function(e)																														//	\
{	if ((e.keyCode == 13)||(e.which == 13)) 																														//	\
	{	var systemID=$(this).attr('systemID');																														//	\
		var userName=$(this).val();																																	//	\
		var permType=$(this).attr('permtype');																														//	\
		var num=$(this).closest('.systemBlock').index('.systemBlock')-1;																							//	\
		myDiv=this;																																					//	\
		$.ajax ({																																					//	\
			type:"POST", url:"/Workspaces/addUserPerm", data: { systemID:systemID.replace(/ /g,'_'), userName:userName.replace(/ /g,'_'), permType:permType },		//	\
			success: function(data) 																																//	\
			{	var myData=JSON.parse(data);																														//	\
				if (myData.error!==undefined)																														//	\
				{	$('#errorLine').html(myData.error);																												//	\
				}else																																				//	\
				{	if (num>=0)																																		//	\
					{	var permNum=partTreeObject[0]['subFiles'][num]['Permissions'].length;																		//	\
						partTreeObject[0]['subFiles'][num]['Permissions'][permNum]={};																				//	\
						partTreeObject[0]['subFiles'][num]['Permissions'][permNum]['Permission']={};																//	\
						partTreeObject[0]['subFiles'][num]['Permissions'][permNum]['Permission']['username']=userName;												//	\
						partTreeObject[0]['subFiles'][num]['Permissions'][permNum]['Permission']['userid']=myData.userid;											//	\
						partTreeObject[0]['subFiles'][num]['Permissions'][permNum]['Permission']['usertype']=myData.usertype;										//	\
						partTreeObject[0]['subFiles'][num]['Permissions'][permNum]['Permission']['admin']=myData.admin;												//	\
						partTreeObject[0]['subFiles'][num]['Permissions'][permNum]['Permission']['edit']=myData.edit;												//	\
						partTreeObject[0]['subFiles'][num]['Permissions'][permNum]['Permission']['use']=myData.use;													//	\
						partTreeObject[0]['subFiles'][num]['Permissions'][permNum]['Permission']['view']=myData.view;												//	\
						htmlText='<div class="permUser" permType="'+permType+'" systemID="'+systemID+'">'+userName+''; 												//	\
						htmlText=htmlText+'<div class="permDelete" permType="'+permType+'" userName="'+userName+'" systemID="'+systemID+'"></div></div>';			//	\
						$(myDiv).closest('.editUserBlock').find('.usersBlock').append(htmlText); 																	//	\
					}else																																			//	\
					{	var permNum=partTreeObject['Permissions'].length;																							//	\
						partTreeObject['Permissions'][permNum]={};																									//	\
						partTreeObject['Permissions'][permNum]['Permission']={};																					//	\
						partTreeObject['Permissions'][permNum]['Permission']['username']=userName;																	//	\
						partTreeObject['Permissions'][permNum]['Permission']['userid']=myData.userid;																//	\
						partTreeObject['Permissions'][permNum]['Permission']['usertype']=myData.usertype;															//	\
						partTreeObject['Permissions'][permNum]['Permission']['admin']=myData.admin;																	//	\
						partTreeObject['Permissions'][permNum]['Permission']['edit']=myData.edit;																	//	\
						partTreeObject['Permissions'][permNum]['Permission']['use']=myData.use;																		//	\
						partTreeObject['Permissions'][permNum]['Permission']['view']=myData.view;																	//	\
						htmlText='<div class="permUser" permType="'+permType+'" systemID="'+systemID+'">'+userName+''; 												//	\
						htmlText=htmlText+'<div class="permDelete" permType="'+permType+'" userName="'+userName+'" systemID="'+systemID+'"></div></div>';			//	\
						$(myDiv).closest('.editUserBlock').find('.usersBlock').append(htmlText); 																	//	\
					}																																				//	\
				}																																					//	\
			},																																						//	\
		    error: function () { alert('There was an error adding that permission.');}																				//	\
		});																																							//	\
	}																																								//	\
});																																									//	\
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*----------------------------------------------------------------- CHANGE A USERS PERMISSION -------------------------------------------------------------------------*/
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*	This is the case where the user has clicked on one of the permissions shown with the intent to change it. 															\
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).on('click', '.permYes, .permNo', function(e)																											//	\
{	var systemID=$(this).attr('systemID');																															//	\
	var permType=$(this).attr('permType');																															//	\
	var userName=$(this).siblings('.permUser').html();																												//	\
	if ($(this).hasClass('permYes')) { var newPerm=0; }																												//	\
	if ($(this).hasClass('permNo')) { var newPerm=1; }																												//	\
	var num=systemID.replace(/^\//,'').split('/').length;																											//	\
	var sP=systemID.replace(/^\//,'').split('/');																													//	\
	myDiv=this;																																						//	\
	if (num==1) { thisObject=partTreeObject['Tree'][sP[0]]; }																										//	\
	if (num==2) { thisObject=partTreeObject['Tree'][sP[0]][sP[1]]; }																								//	\
	if (num==3) { thisObject=partTreeObject['Tree'][sP[0]][sP[1]][sP[2]]; }																							//	\
	if (num==4) { thisObject=partTreeObject['Tree'][sP[0]][sP[1]][sP[2]][sP[3]]; }																					//	\
	if (num==5) { thisObject=partTreeObject['Tree'][sP[0]][sP[1]][sP[2]][sP[3]][sP[4]]; }																			//	\
	if (num==6) { thisObject=partTreeObject['Tree'][sP[0]][sP[1]][sP[2]][sP[3]][sP[4]][sP[5]]; }																	//	\
	if (num==7) { thisObject=partTreeObject['Tree'][sP[0]][sP[1]][sP[2]][sP[3]][sP[4]][sP[5]][sP[6]]; }																//	\
		$.ajax ({																																					//	\
			type:"POST", url:"/Workspaces/changeUserPerm", 																											//	\
			data: { systemID:systemID, permType:permType, userName:userName.replace(/ /g,'_'), newPerm:newPerm },													//	\
			success: function(data) 																																//	\
			{	var myData=JSON.parse(data);																														//	\
				if (myData.error!==undefined)																														//	\
				{	$('#errorLine').html(myData.error);																												//	\
				}else																																				//	\
				{	for (var index in thisObject['permissions'])																									//	\
					{	if (thisObject['permissions'][index]['username']==userName) 																				//	\
						{	thisObject['permissions'][index]['view']=myData.view;																					//	\
							thisObject['permissions'][index]['use']=myData.use;																						//	\
							thisObject['permissions'][index]['edit']=myData.edit;																					//	\
							thisObject['permissions'][index]['admin']=myData.admin;																					//	\
						}																																			//	\
					}																																				//	\
					var admin=getInheritedPermission("admin", userName, systemID, systemID);																		//	\
					var edit=getInheritedPermission("edit", userName, systemID, systemID);																			//	\
					var use=getInheritedPermission("use", userName, systemID, systemID);																			//	\
					var view=getInheritedPermission("view", userName, systemID, systemID);																			//	\
					htmlText='<div class="permUser">'+userName+'</div>'; 																							//	\
					if (admin.toString()=='1')		{	htmlText=htmlText+'<div class="permEveryone" permType="admin" systemID="'+systemID+'"></div>'; 				//	\
					}else if (admin.toString()=='1a'){ 	htmlText=htmlText+'<div class="permYes" permType="admin" systemID="'+systemID+'"></div>'; 		 			//	\
					}else if (admin.toString()=='0a'){ 	htmlText=htmlText+'<div class="permNo" permType="admin" systemID="'+systemID+'"></div>'; 		 			//	\
					}else if (admin.toString()=='1b'){ 	htmlText=htmlText+'<div class="permYesInherit" permType="admin" systemID="'+systemID+'"></div>'; 			//	\
					}else if (admin.toString()=='0b'){ 	htmlText=htmlText+'<div class="permNoInherit" permType="admin" systemID="'+systemID+'"></div>'; }			//	\
					if (edit.toString()=='1')		{	htmlText=htmlText+'<div class="permEveryone" permType="edit" systemID="'+systemID+'"></div>'; 				//	\
					}else if (edit.toString()=='1a'){ 	htmlText=htmlText+'<div class="permYes" permType="edit" systemID="'+systemID+'"></div>'; 					//	\
					}else if (edit.toString()=='0a'){ 	htmlText=htmlText+'<div class="permNo" permType="edit" systemID="'+systemID+'"></div>'; 		 			//	\
					}else if (edit.toString()=='1b'){ 	htmlText=htmlText+'<div class="permYesInherit" permType="edit" systemID="'+systemID+'"></div>'; 			//	\
					}else if (edit.toString()=='0b'){ 	htmlText=htmlText+'<div class="permNoInherit" permType="edit" systemID="'+systemID+'"></div>'; }			//	\
					if (use.toString()=='1')		{	htmlText=htmlText+'<div class="permEveryone" permType="use" systemID="'+systemID+'"></div>'; 				//	\
					}else if (use.toString()=='1a'){ 	htmlText=htmlText+'<div class="permYes" permType="use" systemID="'+systemID+'"></div>'; 					//	\
					}else if (use.toString()=='0a'){ 	htmlText=htmlText+'<div class="permNo" permType="use" systemID="'+systemID+'"></div>'; 		 				//	\
					}else if (use.toString()=='1b'){ 	htmlText=htmlText+'<div class="permYesInherit" permType="use" systemID="'+systemID+'"></div>'; 				//	\
					}else if (use.toString()=='0b'){ 	htmlText=htmlText+'<div class="permNoInherit" permType="use" systemID="'+systemID+'"></div>'; }				//	\
					if (view.toString()=='1')		{	htmlText=htmlText+'<div class="permEveryone" permType="view" systemID="'+systemID+'"></div>'; 				//	\
					}else if (view.toString()=='1a'){ 	htmlText=htmlText+'<div class="permYes" permType="view" systemID="'+systemID+'"></div>'; 					//	\
					}else if (view.toString()=='0a'){ 	htmlText=htmlText+'<div class="permNo" permType="view" systemID="'+systemID+'"></div>'; 					//	\
					}else if (view.toString()=='1b'){ 	htmlText=htmlText+'<div class="permYesInherit" permType="view" systemID="'+systemID+'"></div>'; 			//	\
					}else if (view.toString()=='0b'){ 	htmlText=htmlText+'<div class="permNoInherit" permType="view" systemID="'+systemID+'"></div>'; }			//	\
					$(myDiv).closest('.userPermLine').html(htmlText); 																								//	\
				}																																					//	\
			},																																						//	\
		    error: function () { alert('There was an error adding that permission.');}																				//	\
		});																																							//	\
});																																									//	\
/*---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/




});	